<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARISANIN - Arisan Digital Aman & Mudah</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* =====================================================
           RESET & GLOBAL STYLES
        ===================================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        /* =====================================================
           CONTAINER & LAYOUT
        ===================================================== */
        .container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 600px;
        }
        
        .screen {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s ease;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* === BAGIAN BARU: SIMULATION BADGE === */
        .simulation-badge {
            background: linear-gradient(135deg, #ff9800 0%, #ff6f00 100%);
            color: white;
            padding: 10px 20px;
            text-align: center;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .simulation-badge i {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* =====================================================
           HEADER & LOGO
        ===================================================== */
        .logo {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .logo h1 {
            font-size: 42px;
            font-weight: 700;
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .logo p {
            color: #666;
            font-size: 14px;
        }
        
        .screen-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .screen-subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 30px;
        }
        
        /* =====================================================
           BUTTONS
        ===================================================== */
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
        
        .btn-secondary {
            background: white;
            color: #4caf50;
            border: 2px solid #4caf50;
        }
        
        .btn-secondary:hover {
            background: #f1f8e9;
        }
        
        /* === BAGIAN BARU: BUTTON VARIANTS === */
        .btn-warning {
            background: linear-gradient(135deg, #ff9800 0%, #fb8c00 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #e53935 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
        }
        
        .btn-small {
            padding: 10px 20px;
            font-size: 14px;
            width: auto;
            display: inline-block;
        }
        
        /* =====================================================
           FORM INPUTS
        ===================================================== */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .form-input {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
            transition: border 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #4caf50;
        }
        
        .phone-input {
            display: flex;
            gap: 10px;
        }
        
        .phone-prefix {
            padding: 14px 20px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }
        
        /* === BAGIAN BARU: ROLE SELECTOR === */
        .role-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 25px 0;
        }
        
        .role-card {
            padding: 20px;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .role-card:hover {
            border-color: #4caf50;
            background: #f1f8e9;
        }
        
        .role-card.selected {
            border-color: #4caf50;
            background: #e8f5e9;
        }
        
        .role-card i {
            font-size: 36px;
            margin-bottom: 10px;
            color: #4caf50;
        }
        
        .role-card .role-name {
            font-size: 15px;
            font-weight: 600;
            color: #333;
        }
        
        .role-card .role-desc {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }
        
        /* =====================================================
           DASHBOARD CARDS
        ===================================================== */
        .card-grid {
            display: grid;
            gap: 20px;
            margin-top: 30px;
        }
        
        .card {
            background: white;
            border: 2px solid #e8f5e9;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .card:hover {
            border-color: #4caf50;
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.2);
        }
        
        .card-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .card-icon.green { color: #4caf50; }
        .card-icon.blue { color: #2196f3; }
        .card-icon.orange { color: #ff9800; }
        .card-icon.purple { color: #9c27b0; }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .card-desc {
            font-size: 13px;
            color: #999;
        }
        
        /* =====================================================
           COUNTER (JUMLAH PESERTA)
        ===================================================== */
        .counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .counter-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid #4caf50;
            background: white;
            color: #4caf50;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .counter-btn:hover {
            background: #4caf50;
            color: white;
        }
        
        .counter-value {
            font-size: 32px;
            font-weight: 700;
            color: #4caf50;
            min-width: 60px;
            text-align: center;
        }
        
        /* =====================================================
           RADIO BUTTONS (METODE ARISAN)
        ===================================================== */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .radio-option:hover {
            border-color: #4caf50;
            background: #f1f8e9;
        }
        
        .radio-option input[type="radio"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            cursor: pointer;
        }
        
        .radio-option label {
            cursor: pointer;
            font-size: 15px;
            color: #333;
            font-weight: 500;
        }
        
        .radio-option.selected {
            border-color: #4caf50;
            background: #e8f5e9;
        }
        
        /* =====================================================
           LIST ARISAN & PESERTA
        ===================================================== */
        .arisan-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .arisan-item {
            background: #f9f9f9;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .arisan-item:hover {
            border-color: #4caf50;
            background: #f1f8e9;
        }
        
        .arisan-item-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* === BAGIAN BARU: ARISAN CODE DISPLAY === */
        .arisan-code {
            display: inline-block;
            background: #4caf50;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        /* === BAGIAN BARU: STATUS BADGE === */
        .status-arisan {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .status-draft {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .status-active {
            background: #e8f5e9;
            color: #4caf50;
        }
        
        .status-selesai {
            background: #e0e0e0;
            color: #757575;
        }
        
        .arisan-item-info {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #666;
        }
        
        .peserta-table {
            width: 100%;
            margin: 20px 0;
            border-collapse: collapse;
        }
        
        .peserta-table th {
            background: #4caf50;
            color: white;
            padding: 12px;
            text-align: left;
            font-size: 14px;
        }
        
        .peserta-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 14px;
        }
        
        .peserta-table tr:hover {
            background: #f9f9f9;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-aman {
            background: #e8f5e9;
            color: #4caf50;
        }
        
        .status-belum {
            background: #ffebee;
            color: #f44336;
        }
        
        /* =====================================================
           INFO BOX (KEAMANAN)
        ===================================================== */
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }
        
        .info-box i {
            color: #2196f3;
            font-size: 24px;
        }
        
        .info-box p {
            color: #1976d2;
            font-size: 13px;
            line-height: 1.6;
        }
        
        /* === BAGIAN BARU: WARNING BOX === */
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }
        
        .warning-box i {
            color: #ff9800;
            font-size: 24px;
        }
        
        .warning-box p {
            color: #f57c00;
            font-size: 13px;
            line-height: 1.6;
        }
        
        /* === BAGIAN BARU: LOCK INDICATOR === */
        .lock-indicator {
            background: #f5f5f5;
            border: 2px dashed #bdbdbd;
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            color: #757575;
            font-size: 13px;
            font-weight: 600;
        }
        
        .lock-indicator i {
            margin-right: 8px;
        }
        
        /* =====================================================
           EMPTY STATE
        ===================================================== */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }
        
        .empty-state i {
            font-size: 80px;
            color: #e0e0e0;
            margin-bottom: 20px;
        }
        
        .empty-state h3 {
            color: #999;
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .empty-state p {
            color: #bbb;
            font-size: 14px;
        }
        
        /* =====================================================
           BACK BUTTON
        ===================================================== */
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #4caf50;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            padding: 8px 0;
        }
        
        .back-btn:hover {
            color: #388e3c;
        }
        
        /* =====================================================
           DETAIL ARISAN HEADER
        ===================================================== */
        .arisan-header {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }
        
        .arisan-header h2 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .arisan-meta {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* === BAGIAN BARU: LOG ACTIVITY === */
        .log-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .log-item {
            background: #f9f9f9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            border-radius: 8px;
        }
        
        .log-time {
            font-size: 11px;
            color: #999;
            margin-bottom: 5px;
        }
        
        .log-action {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }
        
        .log-user {
            font-size: 12px;
            color: #666;
            margin-top: 3px;
        }
        
        /* === BAGIAN BARU: ROUND INDICATOR === */
        .round-indicator {
            background: linear-gradient(135deg, #2196f3 0%, #42a5f5 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .round-number {
            font-size: 20px;
            font-weight: 700;
        }
        
        .round-status {
            font-size: 13px;
            opacity: 0.9;
        }
        
        /* === BAGIAN BARU: WINNER CARD === */
        .winner-card {
            background: linear-gradient(135deg, #ffd54f 0%, #ffb300 100%);
            color: #333;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }
        
        .winner-card i {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .winner-card h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .winner-card p {
            font-size: 14px;
            opacity: 0.8;
        }
        
        /* =====================================================
           RESPONSIVE
        ===================================================== */
        @media (max-width: 480px) {
            .container {
                border-radius: 0;
                min-height: 100vh;
            }
            
            body {
                padding: 0;
                background: white;
            }
        }
        
        /* =====================================================
           UTILITY CLASSES
        ===================================================== */
        .mt-20 { margin-top: 20px; }
        .mb-20 { margin-bottom: 20px; }
        .text-center { text-align: center; }
        .hidden { display: none; }
        .flex-between {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .gap-10 { gap: 10px; }
    </style>
</head>
<body>

    <div class="container">
        
        <!-- === BAGIAN BARU: SIMULATION BADGE === -->
        <div class="simulation-badge">
            <i class="fas fa-flask"></i>
            Mode Simulasi ‚Äì Tidak Ada Uang Nyata
        </div>
        
        <!-- =====================================================
             SCREEN 1: LOGIN
        ===================================================== -->
        <div id="screenLogin" class="screen active">
            <div class="logo">
                <h1>ARISANIN</h1>
                <p>Arisan Digital Aman & Mudah</p>
            </div>
            
            <h2 class="screen-title">
                <i class="fas fa-sign-in-alt"></i>
                Masuk dengan WhatsApp
            </h2>
            <p class="screen-subtitle">Nomor HP Anda akan digunakan sebagai identitas</p>
            
            <div class="form-group">
                <label class="form-label">Nomor WhatsApp</label>
                <div class="phone-input">
                    <div class="phone-prefix">+62</div>
                    <input type="tel" id="inputPhone" class="form-input" placeholder="8123456789" maxlength="13">
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Nama Lengkap</label>
                <input type="text" id="inputName" class="form-input" placeholder="Masukkan nama Anda">
            </div>
            
            <!-- === BAGIAN BARU: ROLE SELECTOR === -->
            <div class="form-group">
                <label class="form-label">Pilih Peran Anda</label>
                <div class="role-selector">
                    <div class="role-card selected" onclick="selectRole('admin')" data-role="admin">
                        <i class="fas fa-user-shield"></i>
                        <div class="role-name">Admin Arisan</div>
                        <div class="role-desc">Kelola arisan</div>
                    </div>
                    <div class="role-card" onclick="selectRole('peserta')" data-role="peserta">
                        <i class="fas fa-user"></i>
                        <div class="role-name">Peserta</div>
                        <div class="role-desc">Ikut arisan</div>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="handleLogin()">
                <i class="fas fa-arrow-right"></i> Masuk
            </button>
        </div>
        
        <!-- =====================================================
             SCREEN 2: DASHBOARD (ADMIN)
        ===================================================== -->
        <div id="screenDashboardAdmin" class="screen">
            <div class="logo">
                <h1>ARISANIN</h1>
            </div>
            
            <h2 class="screen-title">
                <i class="fas fa-user-shield"></i>
                Halo Admin, <span id="userNameAdmin"></span>!
            </h2>
            <p class="screen-subtitle">Kelola arisan Anda dengan mudah</p>
            
            <div class="card-grid">
                <div class="card" onclick="showScreen('screenBuatArisan')">
                    <div class="card-icon green">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <div class="card-title">Buat Arisan Baru</div>
                    <div class="card-desc">Mulai arisan dengan teman atau keluarga</div>
                </div>
                
                <div class="card" onclick="showScreen('screenArisanSaya')">
                    <div class="card-icon blue">
                        <i class="fas fa-list-ul"></i>
                    </div>
                    <div class="card-title">Arisan Saya</div>
                    <div class="card-desc">Lihat semua arisan yang Anda kelola</div>
                </div>
                
                <div class="card" onclick="showScreen('screenLogAktivitas')">
                    <div class="card-icon purple">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div class="card-title">Log Aktivitas</div>
                    <div class="card-desc">Riwayat semua aktivitas arisan</div>
                </div>
            </div>
            
            <button class="btn btn-secondary mt-20" onclick="handleLogout()">
                <i class="fas fa-sign-out-alt"></i> Keluar
            </button>
        </div>
        
        <!-- === BAGIAN BARU: DASHBOARD (PESERTA) === -->
        <div id="screenDashboardPeserta" class="screen">
            <div class="logo">
                <h1>ARISANIN</h1>
            </div>
            
            <h2 class="screen-title">
                <i class="fas fa-user"></i>
                Halo, <span id="userNamePeserta"></span>!
            </h2>
            <p class="screen-subtitle">Kelola arisan Anda dengan mudah</p>
            
            <div class="card-grid">
                <div class="card" onclick="showScreen('screenJoinArisan')">
                    <div class="card-icon green">
                        <i class="fas fa-sign-in-alt"></i>
                    </div>
                    <div class="card-title">Gabung Arisan</div>
                    <div class="card-desc">Masukkan kode arisan untuk bergabung</div>
                </div>
                
                <div class="card" onclick="showScreen('screenArisanSaya')">
                    <div class="card-icon blue">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="card-title">Arisan Saya</div>
                    <div class="card-desc">Arisan yang sedang diikuti</div>
                </div>
                
                <div class="card" onclick="showScreen('screenRiwayat')">
                    <div class="card-icon orange">
                        <i class="fas fa-history"></i>
                    </div>
                    <div class="card-title">Riwayat Saya</div>
                    <div class="card-desc">Riwayat pembayaran & kemenangan</div>
                </div>
            </div>
            
            <button class="btn btn-secondary mt-20" onclick="handleLogout()">
                <i class="fas fa-sign-out-alt"></i> Keluar
            </button>
        </div>
        
        <!-- === BAGIAN BARU: JOIN ARISAN (PESERTA) === -->
        <div id="screenJoinArisan" class="screen">
            <div class="back-btn" onclick="backToDashboard()">
                <i class="fas fa-arrow-left"></i> Kembali
            </div>
            
            <h2 class="screen-title">
                <i class="fas fa-sign-in-alt"></i>
                Gabung Arisan
            </h2>
            <p class="screen-subtitle">Masukkan kode arisan yang diberikan oleh admin</p>
            
            <div class="form-group">
                <label class="form-label">Kode Arisan</label>
                <input type="text" id="inputKodeArisan" class="form-input" placeholder="Contoh: ARSN-4821" style="text-transform: uppercase;">
            </div>
            
            <div class="info-box">
                <i class="fas fa-info-circle"></i>
                <p>
                    Minta kode arisan kepada admin atau koordinator arisan Anda. Kode ini diperlukan untuk bergabung.
                </p>
            </div>
            
            <button class="btn btn-primary" onclick="handleJoinArisan()">
                <i class="fas fa-check"></i> Gabung Sekarang
            </button>
        </div>
        
        <!-- =====================================================
             SCREEN 3: BUAT ARISAN
        ===================================================== -->
        <div id="screenBuatArisan" class="screen">
            <div class="back-btn" onclick="backToDashboard()">
                <i class="fas fa-arrow-left"></i> Kembali
            </div>
            
            <h2 class="screen-title">
                <i class="fas fa-plus-circle"></i>
                Buat Arisan Baru
            </h2>
            <p class="screen-subtitle">Isi informasi arisan yang akan dibuat</p>
            
            <div class="form-group">
                <label class="form-label">Nama Arisan</label>
                <input type="text" id="inputNamaArisan" class="form-input" placeholder="Contoh: Arisan Keluarga">
            </div>
            
            <div class="form-group">
                <label class="form-label">Jumlah Peserta</label>
                <div class="counter">
                    <button class="counter-btn" onclick="changeCounter(-1)">
                        <i class="fas fa-minus"></i>
                    </button>
                    <div class="counter-value" id="counterPeserta">5</div>
                    <button class="counter-btn" onclick="changeCounter(1)">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Nominal Per Orang (Rp)</label>
                <input type="number" id="inputNominal" class="form-input" placeholder="100000">
            </div>
            
            <div class="form-group">
                <label class="form-label">Metode Pengundian</label>
                <div class="radio-group">
                    <div class="radio-option selected" onclick="selectMetode('acak')">
                        <input type="radio" name="metode" value="acak" id="metodeAcak" checked>
                        <label for="metodeAcak">
                            <strong>Undian Acak</strong><br>
                            <small>Sistem akan mengundi siapa yang mendapat giliran</small>
                        </label>
                    </div>
                    <div class="radio-option" onclick="selectMetode('urutan')">
                        <input type="radio" name="metode" value="urutan" id="metodeUrutan">
                        <label for="metodeUrutan">
                            <strong>Urutan Tetap</strong><br>
                            <small>Giliran sesuai urutan yang sudah ditentukan</small>
                        </label>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="handleBuatArisan()">
                <i class="fas fa-check"></i> Buat Arisan
            </button>
        </div>
        
        <!-- =====================================================
             SCREEN 4: ARISAN SAYA (LIST)
        ===================================================== -->
        <div id="screenArisanSaya" class="screen">
            <div class="back-btn" onclick="backToDashboard()">
                <i class="fas fa-arrow-left"></i> Kembali
            </div>
            
            <h2 class="screen-title">
                <i class="fas fa-list-ul"></i>
                Arisan Saya
            </h2>
            <p class="screen-subtitle" id="arisanSayaSubtitle">Semua arisan yang sedang berjalan</p>
            
            <div id="arisanListContainer" class="arisan-list">
                <!-- Dynamic content -->
            </div>
        </div>
        
        <!-- =====================================================
             SCREEN 5: DETAIL ARISAN
        ===================================================== -->
        <div id="screenDetailArisan" class="screen">
            <div class="back-btn" onclick="showScreen('screenArisanSaya')">
                <i class="fas fa-arrow-left"></i> Kembali
            </div>
            
            <div class="arisan-header">
                <div class="flex-between">
                    <div>
                        <h2 id="detailNamaArisan">-</h2>
                        <div class="arisan-meta">
                            <span><i class="fas fa-users"></i> <span id="detailJumlahPeserta">0</span> Peserta</span>
                            <span><i class="fas fa-money-bill-wave"></i> Rp <span id="detailNominal">0</span></span>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 15px; display: flex; gap: 10px; align-items: center;">
                    <span class="arisan-code" id="detailKodeArisan">ARSN-0000</span>
                    <span class="status-arisan" id="detailStatusArisan">DRAFT</span>
                </div>
            </div>
            
            <!-- === BAGIAN BARU: ROUND INDICATOR === -->
            <div id="roundIndicatorContainer"></div>
            
            <!-- === BAGIAN BARU: WINNER DISPLAY === -->
            <div id="winnerContainer"></div>
            
            <!-- === PERUBAHAN: LOCK INDICATOR === -->
            <div id="lockIndicator" class="lock-indicator hidden">
                <i class="fas fa-lock"></i> Data terkunci setelah arisan dimulai
            </div>
            
            <h3 style="margin-bottom: 15px; color: #333;">
                <i class="fas fa-users"></i> Daftar Peserta
            </h3>
            
            <table class="peserta-table">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Nama</th>
                        <th>Status</th>
                        <th id="actionHeader">Aksi</th>
                    </tr>
                </thead>
                <tbody id="pesertaTableBody">
                    <!-- Dynamic content -->
                </tbody>
            </table>
            
            <!-- === BAGIAN BARU: ADMIN CONTROLS === -->
            <div id="adminControls" class="hidden">
                <button class="btn btn-warning mb-20" onclick="handleAktifkanArisan()">
                    <i class="fas fa-play"></i> Aktifkan Arisan
                </button>
                <button class="btn btn-primary" onclick="handleUndiPemenang()">
                    <i class="fas fa-trophy"></i> Undi Pemenang Putaran Ini
                </button>
            </div>
            
            <!-- === BAGIAN BARU: PESERTA INFO === -->
            <div id="pesertaInfo" class="hidden">
                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <p id="pesertaStatusText">-</p>
                </div>
            </div>
            
            <div class="info-box">
                <i class="fas fa-shield-alt"></i>
                <p>
                    <strong>Uang Anda Aman!</strong><br>
                    Sistem ARISANIN hanya mencatat pembayaran. Uang disimpan aman oleh koordinator arisan, admin tidak bisa menarik dana Anda.
                </p>
            </div>
        </div>
        
        <!-- === BAGIAN BARU: LOG AKTIVITAS === -->
        <div id="screenLogAktivitas" class="screen">
            <div class="back-btn" onclick="backToDashboard()">
                <i class="fas fa-arrow-left"></i> Kembali
            </div>
            
            <h2 class="screen-title">
                <i class="fas fa-clipboard-list"></i>
                Log Aktivitas
            </h2>
            <p class="screen-subtitle">Riwayat semua aktivitas dalam arisan</p>
            
            <div id="logListContainer" class="log-list">
                <!-- Dynamic content -->
            </div>
        </div>
        
        <!-- =====================================================
             SCREEN 6: RIWAYAT PEMBAYARAN
        ===================================================== -->
        <div id="screenRiwayat" class="screen">
            <div class="back-btn" onclick="backToDashboard()">
                <i class="fas fa-arrow-left"></i> Kembali
            </div>
            
            <h2 class="screen-title">
                <i class="fas fa-history"></i>
                Riwayat Pembayaran
            </h2>
            <p class="screen-subtitle">Transaksi yang sudah dicatat</p>
            
            <div id="riwayatContainer">
                <!-- Dynamic content -->
            </div>
        </div>
        
    </div>

    <script>
        // =====================================================
        // üî• FIREBASE CONFIG (AKAN DIGANTI NANTI)
        // =====================================================
        const firebaseConfig = {
            apiKey: "PASTE_API_KEY_DI_SINI",
            authDomain: "PASTE_AUTH_DOMAIN",
            projectId: "PASTE_PROJECT_ID",
            storageBucket: "PASTE_STORAGE_BUCKET",
            messagingSenderId: "PASTE_SENDER_ID",
            appId: "PASTE_APP_ID"
        };
        
        // ‚ö†Ô∏è SAAT INI BELUM DIGUNAKAN
        // Semua data masih via localStorage
        
        // === BAGIAN BARU: APP MODE ===
        const APP_MODE = "SIMULATION";
        
        // =====================================================
        // GLOBAL STATE & VARIABLES
        // =====================================================
        let currentUser = null;
        let currentArisanId = null;
        let counterValue = 5;
        let selectedRole = 'admin'; // === BAGIAN BARU ===
        
        // =====================================================
        // INITIALIZE APP
        // =====================================================
        window.onload = function() {
            // Cek apakah user sudah login
            const savedUser = localStorage.getItem('arisan_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboardByRole();
            }
        };
        
        // === BAGIAN BARU: SHOW DASHBOARD BY ROLE ===
        function showDashboardByRole() {
            if (currentUser.role === 'admin') {
                showScreen('screenDashboardAdmin');
                document.getElementById('userNameAdmin').textContent = currentUser.name;
            } else {
                showScreen('screenDashboardPeserta');
                document.getElementById('userNamePeserta').textContent = currentUser.name;
            }
        }
        
        // === BAGIAN BARU: BACK TO DASHBOARD ===
        function backToDashboard() {
            showDashboardByRole();
        }
        
        // =====================================================
        // NAVIGATION: SHOW SCREEN
        // =====================================================
        function showScreen(screenId) {
            // Sembunyikan semua screen
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Tampilkan screen yang dipilih
            document.getElementById(screenId).classList.add('active');
            
            // Refresh data jika perlu
            if (screenId === 'screenArisanSaya') {
                loadArisanList();
            } else if (screenId === 'screenLogAktivitas') {
                loadLogAktivitas();
            } else if (screenId === 'screenRiwayat') {
                loadRiwayatPembayaran();
            }
        }
        
        // === BAGIAN BARU: SELECT ROLE ===
        function selectRole(role) {
            selectedRole = role;
            
            // Update visual
            const roleCards = document.querySelectorAll('.role-card');
            roleCards.forEach(card => {
                card.classList.remove('selected');
                if (card.dataset.role === role) {
                    card.classList.add('selected');
                }
            });
        }
        
        // =====================================================
        // LOGIN HANDLER (PERUBAHAN: TAMBAH ROLE)
        // =====================================================
        function handleLogin() {
            const phone = document.getElementById('inputPhone').value.trim();
            const name = document.getElementById('inputName').value.trim();
            
            // Validasi input
            if (!phone || !name) {
                alert('‚ùå Mohon isi nomor WhatsApp dan nama lengkap Anda!');
                return;
            }
            
            if (phone.length < 9) {
                alert('‚ùå Nomor WhatsApp tidak valid! Minimal 9 digit.');
                return;
            }
            
            // === PERUBAHAN: TAMBAH ROLE ===
            currentUser = {
                id: 'user_' + Date.now(),
                phone: '+62' + phone,
                name: name,
                role: selectedRole
            };
            
            // Simpan ke localStorage
            localStorage.setItem('arisan_user', JSON.stringify(currentUser));
            
            // === BAGIAN BARU: LOG LOGIN ===
            addLog('Login', `${name} masuk sebagai ${selectedRole === 'admin' ? 'Admin' : 'Peserta'}`, null);
            
            // Pindah ke dashboard sesuai role
            showDashboardByRole();
            
            // Reset form
            document.getElementById('inputPhone').value = '';
            document.getElementById('inputName').value = '';
        }
        
        // =====================================================
        // LOGOUT HANDLER
        // =====================================================
        function handleLogout() {
            const confirm = window.confirm('Apakah Anda yakin ingin keluar?');
            if (confirm) {
                // === BAGIAN BARU: LOG LOGOUT ===
                addLog('Logout', `${currentUser.name} keluar dari aplikasi`, null);
                
                currentUser = null;
                localStorage.removeItem('arisan_user');
                showScreen('screenLogin');
            }
        }
        
        // =====================================================
        // COUNTER (JUMLAH PESERTA)
        // =====================================================
        function changeCounter(change) {
            counterValue += change;
            
            // Minimal 2 peserta
            if (counterValue < 2) {
                counterValue = 2;
            }
            
            // Maksimal 50 peserta
            if (counterValue > 50) {
                counterValue = 50;
            }
            
            document.getElementById('counterPeserta').textContent = counterValue;
        }
        
        // =====================================================
        // SELECT METODE (RADIO BUTTON)
        // =====================================================
        function selectMetode(metode) {
            // Update radio button
            if (metode === 'acak') {
                document.getElementById('metodeAcak').checked = true;
            } else {
                document.getElementById('metodeUrutan').checked = true;
            }
            
            // Update visual
            const options = document.querySelectorAll('.radio-option');
            options.forEach(opt => opt.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
        }
        
        // === BAGIAN BARU: GENERATE ARISAN CODE ===
        function generateArisanCode() {
            const prefix = 'ARSN';
            const random = Math.floor(1000 + Math.random() * 9000);
            return `${prefix}-${random}`;
        }
        
        // =====================================================
        // BUAT ARISAN HANDLER (PERUBAHAN: STRUKTUR DATA BARU)
        // =====================================================
        function handleBuatArisan() {
            const namaArisan = document.getElementById('inputNamaArisan').value.trim();
            const nominal = document.getElementById('inputNominal').value.trim();
            const metode = document.querySelector('input[name="metode"]:checked').value;
            
            // Validasi
            if (!namaArisan) {
                alert('‚ùå Mohon isi nama arisan!');
                return;
            }
            
            if (!nominal || nominal < 10000) {
                alert('‚ùå Nominal minimal Rp 10.000!');
                return;
            }
            
            // Konfirmasi
            const confirmMsg = `Apakah data sudah benar?\n\nNama: ${namaArisan}\nPeserta: ${counterValue} orang\nNominal: Rp ${parseInt(nominal).toLocaleString('id-ID')}\nMetode: ${metode === 'acak' ? 'Undian Acak' : 'Urutan Tetap'}`;
            
            if (!confirm(confirmMsg)) {
                return;
            }
            
            // === PERUBAHAN: STRUKTUR DATA BARU ===
            const arisan = {
                id: 'arisan_' + Date.now(),
                code: generateArisanCode(),
                name: namaArisan,
                nominal: parseInt(nominal),
                maxPeserta: counterValue,
                peserta: [],
                metode: metode,
                status: 'draft', // draft, active, selesai
                adminId: currentUser.id,
                adminName: currentUser.name,
                currentRound: 0,
                rounds: [],
                createdAt: new Date().toISOString()
            };
            
            // Simpan ke localStorage
            let arisanList = JSON.parse(localStorage.getItem('arisan_list') || '[]');
            arisanList.push(arisan);
            localStorage.setItem('arisan_list', JSON.stringify(arisanList));
            
            // === BAGIAN BARU: LOG AKTIVITAS ===
            addLog('Buat Arisan', `${currentUser.name} membuat arisan "${namaArisan}"`, arisan.id);
            
            alert(`‚úÖ Arisan berhasil dibuat!\n\nKode Arisan: ${arisan.code}\n\nBagikan kode ini kepada peserta untuk bergabung.`);
            
            // Reset form
            document.getElementById('inputNamaArisan').value = '';
            document.getElementById('inputNominal').value = '';
            counterValue = 5;
            document.getElementById('counterPeserta').textContent = '5';
            
            // Kembali ke dashboard
            backToDashboard();
        }
        
        // === BAGIAN BARU: JOIN ARISAN (PESERTA) ===
        function handleJoinArisan() {
            const kode = document.getElementById('inputKodeArisan').value.trim().toUpperCase();
            
            if (!kode) {
                alert('‚ùå Mohon masukkan kode arisan!');
                return;
            }
            
            // Cari arisan dengan kode
            let arisanList = JSON.parse(localStorage.getItem('arisan_list') || '[]');
            const arisanIndex = arisanList.findIndex(a => a.code === kode);
            
            if (arisanIndex === -1) {
                alert('‚ùå Kode arisan tidak ditemukan!\n\nPastikan kode yang Anda masukkan benar.');
                return;
            }
            
            const arisan = arisanList[arisanIndex];
            
            // Cek apakah sudah bergabung
            const sudahGabung = arisan.peserta.some(p => p.userId === currentUser.id);
            if (sudahGabung) {
                alert('‚ÑπÔ∏è Anda sudah terdaftar di arisan ini!');
                showScreen('screenArisanSaya');
                return;
            }
            
            // Cek apakah arisan sudah penuh
            if (arisan.peserta.length >= arisan.maxPeserta) {
                alert('‚ùå Arisan sudah penuh!\n\nTidak bisa menambah peserta lagi.');
                return;
            }
            
            // Tambah peserta
            const peserta = {
                id: 'peserta_' + Date.now(),
                userId: currentUser.id,
                name: currentUser.name,
                phone: currentUser.phone,
                statusBayar: {},
                joinedAt: new Date().toISOString()
            };
            
            arisan.peserta.push(peserta);
            arisanList[arisanIndex] = arisan;
            localStorage.setItem('arisan_list', JSON.stringify(arisanList));
            
            // === BAGIAN BARU: LOG JOIN ===
            addLog('Join Arisan', `${currentUser.name} bergabung ke arisan "${arisan.name}"`, arisan.id);
            
            alert(`‚úÖ Berhasil bergabung!\n\nAnda sekarang terdaftar di arisan "${arisan.name}"`);
            
            // Reset & pindah
            document.getElementById('inputKodeArisan').value = '';
            showScreen('screenArisanSaya');
        }
        
        // =====================================================
        // LOAD ARISAN LIST (PERUBAHAN: SESUAIKAN ROLE)
        // =====================================================
        function loadArisanList() {
            const container = document.getElementById('arisanListContainer');
            const arisanList = JSON.parse(localStorage.getItem('arisan_list') || '[]');
            
            let myArisan = [];
            
            // === PERUBAHAN: FILTER SESUAI ROLE ===
            if (currentUser.role === 'admin') {
                // Admin: lihat arisan yang dibuat
                myArisan = arisanList.filter(a => a.adminId === currentUser.id);
                document.getElementById('arisanSayaSubtitle').textContent = 'Arisan yang Anda kelola';
            } else {
                // Peserta: lihat arisan yang diikuti
                myArisan = arisanList.filter(a => 
                    a.peserta.some(p => p.userId === currentUser.id)
                );
                document.getElementById('arisanSayaSubtitle').textContent = 'Arisan yang Anda ikuti';
            }
            
            if (myArisan.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>Belum Ada Arisan</h3>
                        <p>${currentUser.role === 'admin' ? 'Buat arisan pertama Anda sekarang!' : 'Gabung arisan dengan memasukkan kode!'}</p>
                    </div>
                `;
                return;
            }
            
            // Render list
            container.innerHTML = myArisan.map(arisan => {
                const totalPeserta = arisan.peserta.length;
                const maxPeserta = arisan.maxPeserta;
                
                // Hitung status bayar untuk round aktif
                let statusBayarText = '';
                if (arisan.status === 'active' && arisan.currentRound > 0) {
                    const sudahBayar = arisan.peserta.filter(p => 
                        p.statusBayar['round_' + arisan.currentRound] === true
                    ).length;
                    statusBayarText = `<i class="fas fa-check-circle"></i> ${sudahBayar}/${totalPeserta} Sudah Bayar`;
                }
                
                return `
                    <div class="arisan-item" onclick="showDetailArisan('${arisan.id}')">
                        <div class="arisan-item-title">
                            ${arisan.name}
                            <span class="status-arisan status-${arisan.status}">${arisan.status.toUpperCase()}</span>
                        </div>
                        <div class="arisan-item-info">
                            <span><i class="fas fa-users"></i> ${totalPeserta}/${maxPeserta} Peserta</span>
                            <span><i class="fas fa-money-bill-wave"></i> Rp ${arisan.nominal.toLocaleString('id-ID')}</span>
                        </div>
                        ${statusBayarText ? `
                        <div class="arisan-item-info" style="margin-top: 8px;">
                            <span style="color: #4caf50;">${statusBayarText}</span>
                            <span style="color: #666;">Putaran ${arisan.currentRound}</span>
                        </div>
                        ` : ''}
                        <div class="arisan-item-info" style="margin-top: 8px;">
                            <span class="arisan-code">${arisan.code}</span>
                            <span style="color: #999; font-size: 11px;">Admin: ${arisan.adminName}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // =====================================================
        // SHOW DETAIL ARISAN (PERUBAHAN BESAR: SESUAI ROLE)
        // =====================================================
        function showDetailArisan(arisanId) {
            currentArisanId = arisanId;
            
            const arisanList = JSON.parse(localStorage.getItem('arisan_list') || '[]');
            const arisan = arisanList.find(a => a.id === arisanId);
            
            if (!arisan) {
                alert('‚ùå Arisan tidak ditemukan!');
                return;
            }
            
            // Update header
            document.getElementById('detailNamaArisan').textContent = arisan.name;
            document.getElementById('detailJumlahPeserta').textContent = arisan.peserta.length + '/' + arisan.maxPeserta;
            document.getElementById('detailNominal').textContent = arisan.nominal.toLocaleString('id-ID');
            document.getElementById('detailKodeArisan').textContent = arisan.code;
            document.getElementById('detailStatusArisan').textContent = arisan.status.toUpperCase();
            document.getElementById('detailStatusArisan').className = 'status-arisan status-' + arisan.status;
            
            // === BAGIAN BARU: ROUND INDICATOR ===
            const roundContainer = document.getElementById('roundIndicatorContainer');
            if (arisan.status === 'active') {
                roundContainer.innerHTML = `
                    <div class="round-indicator">
                        <div class="round-number">
                            <i class="fas fa-redo"></i> Putaran ${arisan.currentRound}
                        </div>
                        <div class="round-status">
                            ${arisan.peserta.length} Peserta Aktif
                        </div>
                    </div>
                `;
            } else {
                roundContainer.innerHTML = '';
            }
            
            // === BAGIAN BARU: WINNER DISPLAY ===
            const winnerContainer = document.getElementById('winnerContainer');
            if (arisan.currentRound > 0 && arisan.rounds.length > 0) {
                const lastRound = arisan.rounds[arisan.rounds.length - 1];
                if (lastRound.winner) {
                    winnerContainer.innerHTML = `
                        <div class="winner-card">
                            <i class="fas fa-trophy"></i>
                            <h3>Pemenang Putaran ${lastRound.roundNumber}</h3>
                            <p>${lastRound.winner.name}</p>
                        </div>
                    `;
                } else {
                    winnerContainer.innerHTML = '';
                }
            } else {
                winnerContainer.innerHTML = '';
            }
            
            // === PERUBAHAN: LOCK INDICATOR ===
            const lockIndicator = document.getElementById('lockIndicator');
            if (arisan.status !== 'draft') {
                lockIndicator.classList.remove('hidden');
            } else {
                lockIndicator.classList.add('hidden');
            }
            
            // === PERUBAHAN: RENDER TABEL SESUAI ROLE ===
            const isAdmin = currentUser.role === 'admin' && arisan.adminId === currentUser.id;
            const actionHeader = document.getElementById('actionHeader');
            
            if (isAdmin) {
                actionHeader.textContent = 'Status';
            } else {
                actionHeader.textContent = 'Aksi';
            }
            
            const tbody = document.getElementById('pesertaTableBody');
            tbody.innerHTML = arisan.peserta.map((peserta, index) => {
                const roundKey = 'round_' + arisan.currentRound;
                const sudahBayar = peserta.statusBayar[roundKey] === true;
                
                let actionContent = '';
                
                if (isAdmin) {
                    // Admin: hanya lihat status
                    const status = sudahBayar 
                        ? '<span class="status-badge status-aman"><i class="fas fa-check"></i> Lunas</span>'
                        : '<span class="status-badge status-belum"><i class="fas fa-times"></i> Belum</span>';
                    actionContent = status;
                } else {
                    // Peserta: bisa bayar untuk diri sendiri
                    if (peserta.userId === currentUser.id) {
                        if (arisan.status === 'active' && !sudahBayar) {
                            actionContent = `<button class="btn btn-primary btn-small" onclick="handleBayarSimulasi('${arisan.id}', '${peserta.id}')"><i class="fas fa-money-bill"></i> Bayar</button>`;
                        } else if (sudahBayar) {
                            actionContent = '<span class="status-badge status-aman"><i class="fas fa-check"></i> Lunas</span>';
                        } else {
                            actionContent = '<span style="color: #999; font-size: 12px;">Menunggu</span>';
                        }
                    } else {
                        actionContent = '<span style="color: #999; font-size: 12px;">-</span>';
                    }
                }
                
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${peserta.name}${peserta.userId === currentUser.id ? ' <strong>(Anda)</strong>' : ''}</td>
                        <td>${sudahBayar ? '<span class="status-badge status-aman"><i class="fas fa-check"></i> Sudah Bayar</span>' : '<span class="status-badge status-belum"><i class="fas fa-times"></i> Belum Bayar</span>'}</td>
                        <td>${actionContent}</td>
                    </tr>
                `;
            }).join('');
            
            // === BAGIAN BARU: SHOW/HIDE CONTROLS SESUAI ROLE ===
            const adminControls = document.getElementById('adminControls');
            const pesertaInfo = document.getElementById('pesertaInfo');
            
            if (isAdmin) {
                adminControls.classList.remove('hidden');
                pesertaInfo.classList.add('hidden');
                
                // Update button aktifkan arisan
                const btnAktifkan = adminControls.querySelector('button:first-child');
                if (arisan.status === 'draft') {
                    btnAktifkan.style.display = 'block';
                } else {
                    btnAktifkan.style.display = 'none';
                }
                
                // Update button undi
                const btnUndi = adminControls.querySelector('button:last-child');
                if (arisan.status === 'active') {
                    btnUndi.style.display = 'block';
                } else {
                    btnUndi.style.display = 'none';
                }
            } else {
                adminControls.classList.add('hidden');
                pesertaInfo.classList.remove('hidden');
                
                // Update info peserta
                const myData = arisan.peserta.find(p => p.userId === currentUser.id);
                if (myData) {
                    const roundKey = 'round_' + arisan.currentRound;
                    const sudahBayar = myData.statusBayar[roundKey] === true;
                    
                    let statusText = '';
                    if (arisan.status === 'draft') {
                        statusText = 'Arisan belum dimulai. Tunggu admin mengaktifkan arisan.';
                    } else if (arisan.status === 'active') {
                        if (sudahBayar) {
                            statusText = `Anda sudah membayar untuk putaran ${arisan.currentRound}. Terima kasih!`;
                        } else {
                            statusText = `Silakan lakukan pembayaran untuk putaran ${arisan.currentRound}.`;
                        }
                    } else {
                        statusText = 'Arisan sudah selesai.';
                    }
                    
                    document.getElementById('pesertaStatusText').innerHTML = `<strong>Status Anda:</strong><br>${statusText}`;
                }
            }
            
            // Tampilkan screen
            showScreen('screenDetailArisan');
        }
        
        // === BAGIAN BARU: AKTIFKAN ARISAN ===
        function handleAktifkanArisan() {
            const arisanList = JSON.parse(localStorage.getItem('arisan_list') || '[]');
            const arisanIndex = arisanList.findIndex(a => a.id === currentArisanId);
            
            if (arisanIndex === -1) return;
            
            const arisan = arisanList[arisanIndex];
            
            if (arisan.peserta.length < 2) {
                alert('‚ùå Minimal 2 peserta untuk mengaktifkan arisan!');
                return;
            }
            
            if (!confirm(`Aktifkan arisan "${arisan.name}"?\n\nSetelah diaktifkan, data arisan akan terkunci dan putaran pertama akan dimulai.`)) {
                return;
            }
            
            // Aktifkan arisan
            arisan.status = 'active';
            arisan.currentRound = 1;
            arisan.rounds.push({
                roundNumber: 1,
                startedAt: new Date().toISOString(),
                winner: null
            });
            
            arisanList[arisanIndex] = arisan;
            localStorage.setItem('arisan_list', JSON.stringify(arisanList));
            
            // Log
            addLog('Aktifkan Arisan', `${currentUser.name} mengaktifkan arisan "${arisan.name}"`, arisan.id);
            
            alert('‚úÖ Arisan berhasil diaktifkan!\n\nPutaran 1 dimulai sekarang.');
            
            // Refresh
            showDetailArisan(currentArisanId);
        }
        
        // === BAGIAN BARU: BAYAR SIMULASI ===
        function handleBayarSimulasi(arisanId, pesertaId) {
            const arisanList = JSON.parse(localStorage.getItem('arisan_list') || '[]');
            const arisanIndex = arisanList.findIndex(a => a.id === arisanId);
            
            if (arisanIndex === -1) return;
            
            const arisan = arisanList[arisanIndex];
            const pesertaIndex = arisan.peserta.findIndex(p => p.id === pesertaId);
            
            if (pesertaIndex === -1) return;
            
            const roundKey = 'round_' + arisan.currentRound;
            
            if (!confirm(`Bayar untuk Putaran ${arisan.currentRound}?\n\nNominal: Rp ${arisan.nominal.toLocaleString('id-ID')}\n\n‚ö†Ô∏è Ini hanya simulasi, tidak ada uang sungguhan.`)) {
                return;
            }
            
            // Tandai sudah bayar
            arisan.peserta[pesertaIndex].statusBayar[roundKey] = true;
            arisan.peserta[pesertaIndex].statusBayar[roundKey + '_date'] = new Date().toISOString();
            
            arisanList[arisanIndex] = arisan;
            localStorage.setItem('arisan_list', JSON.stringify(arisanList));
            
            // Simpan ke riwayat
            addPaymentHistory(arisan, currentUser.name, arisan.currentRound);
            
            // Log
            addLog('Bayar', `${currentUser.name} membayar putaran ${arisan.currentRound} di arisan "${arisan.name}"`, arisan.id);
            
            alert('‚úÖ Pembayaran berhasil dicatat!\n\nStatus Anda: LUNAS untuk putaran ini.');
            
            // Refresh
            showDetailArisan(currentArisanId);
        }
        
        // === BAGIAN BARU: UNDI PEMENANG ===
        function handleUndiPemenang() {
            const arisanList = JSON.parse(localStorage.getItem('arisan_list') || '[]');
            const arisanIndex = arisanList.findIndex(a => a.id === currentArisanId);
            
            if (arisanIndex === -1) return;
            
            const arisan = arisanList[arisanIndex];
            
            // Cek apakah semua sudah bayar
            const roundKey = 'round_' + arisan.currentRound;
            const belumBayar = arisan.peserta.filter(p => !p.statusBayar[roundKey]);
            
            if (belumBayar.length > 0) {
                alert(`‚ö†Ô∏è Masih ada ${belumBayar.length} peserta yang belum bayar!\n\nPastikan semua peserta sudah bayar sebelum mengundi.`);
                return;
            }
            
            // Cek apakah sudah ada pemenang di round ini
            const currentRoundData = arisan.rounds.find(r => r.roundNumber === arisan.currentRound);
            if (currentRoundData && currentRoundData.winner) {
                alert('‚ÑπÔ∏è Pemenang putaran ini sudah diundi!\n\nTidak bisa mengundi ulang.');
                return;
            }
            
            if (!confirm(`Undi pemenang untuk Putaran ${arisan.currentRound}?\n\nProses ini tidak bisa diubah setelah dijalankan.`)) {
                return;
            }
            
            // Undi secara acak
            const randomIndex = Math.floor(Math.random() * arisan.peserta.length);
            const winner = arisan.peserta[randomIndex];
            
            // Update round
            const roundIndex = arisan.rounds.findIndex(r => r.roundNumber === arisan.currentRound);
            arisan.rounds[roundIndex].winner = {
                id: winner.id,
                name: winner.name
            };
            arisan.rounds[roundIndex].drawnAt = new Date().toISOString();
            
            // Jika masih ada putaran berikutnya
            if (arisan.currentRound < arisan.peserta.length) {
                arisan.currentRound++;
                arisan.rounds.push({
                    roundNumber: arisan.currentRound,
                    startedAt: new Date().toISOString(),
                    winner: null
                });
            } else {
                // Arisan selesai
                arisan.status = 'selesai';
            }
            
            arisanList[arisanIndex] = arisan;
            localStorage.setItem('arisan_list', JSON.stringify(arisanList));
            
            // Log
            addLog('Undi Pemenang', `Pemenang putaran ${arisan.currentRound - 1} arisan "${arisan.name}": ${winner.name}`, arisan.id);
            
            alert(`üéâ Selamat!\n\nPemenang Putaran ${arisan.currentRound - 1}:\n${winner.name}\n\n${arisan.status === 'selesai' ? 'Arisan telah selesai!' : 'Putaran berikutnya dimulai sekarang.'}`);
            
            // Refresh
            showDetailArisan(currentArisanId);
        }
        
        // === BAGIAN BARU: ADD LOG AKTIVITAS ===
        function addLog(action, description, arisanId) {
            let logs = JSON.parse(localStorage.getItem('arisan_logs') || '[]');
            
            const log = {
                id: 'log_' + Date.now(),
                time: new Date().toISOString(),
                userName: currentUser.name,
                userId: currentUser.id,
                role: currentUser.role,
                action: action,
                description: description,
                arisanId: arisanId
            };
            
            logs.unshift(log); // Tambah di awal
            
            // Batasi 100 log terakhir
            if (logs.length > 100) {
                logs = logs.slice(0, 100);
            }
            
            localStorage.setItem('arisan_logs', JSON.stringify(logs));
        }
        
        // === BAGIAN BARU: LOAD LOG AKTIVITAS ===
        function loadLogAktivitas() {
            const container = document.getElementById('logListContainer');
            const logs = JSON.parse(localStorage.getItem('arisan_logs') || '[]');
            
            // Filter log sesuai role
            let filteredLogs = logs;
            if (currentUser.role === 'admin') {
                // Admin: lihat semua log dari arisan yang dia kelola
                const arisanList = JSON.parse(localStorage.getItem('arisan_list') || '[]');
                const myArisanIds = arisanList.filter(a => a.adminId === currentUser.id).map(a => a.id);
                filteredLogs = logs.filter(l => !l.arisanId || myArisanIds.includes(l.arisanId) || l.userId === currentUser.id);
            } else {
                // Peserta: lihat log diri sendiri saja
                filteredLogs = logs.filter(l => l.userId === currentUser.id);
            }
            
            if (filteredLogs.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>Belum Ada Log</h3>
                        <p>Aktivitas akan tercatat di sini</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredLogs.map(log => {
                const date = new Date(log.time);
                const timeStr = date.toLocaleString('id-ID', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                return `
                    <div class="log-item">
                        <div class="log-time">${timeStr}</div>
                        <div class="log-action">${log.description}</div>
                        <div class="log-user">Oleh: ${log.userName} (${log.role === 'admin' ? 'Admin' : 'Peserta'})</div>
                    </div>
                `;
            }).join('');
        }
        
        // === BAGIAN BARU: ADD PAYMENT HISTORY ===
        function addPaymentHistory(arisan, userName, round) {
            let history = JSON.parse(localStorage.getItem('arisan_payments') || '[]');
            
            const payment = {
                id: 'payment_' + Date.now(),
                arisanId: arisan.id,
                arisanName: arisan.name,
                userName: userName,
                userId: currentUser.id,
                round: round,
                nominal: arisan.nominal,
                date: new Date().toISOString()
            };
            
            history.unshift(payment);
            
            // Batasi 200 riwayat
            if (history.length > 200) {
                history = history.slice(0, 200);
            }
            
            localStorage.setItem('arisan_payments', JSON.stringify(history));
        }
        
        // === BAGIAN BARU: LOAD RIWAYAT PEMBAYARAN ===
        function loadRiwayatPembayaran() {
            const container = document.getElementById('riwayatContainer');
            const history = JSON.parse(localStorage.getItem('arisan_payments') || '[]');
            
            // Filter riwayat user ini saja
            const myHistory = history.filter(h => h.userId === currentUser.id);
            
            if (myHistory.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-file-invoice"></i>
                        <h3>Belum Ada Riwayat</h3>
                        <p>Riwayat pembayaran akan muncul di sini</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <table class="peserta-table">
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Arisan</th>
                            <th>Putaran</th>
                            <th>Nominal</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${myHistory.map(h => {
                            const date = new Date(h.date);
                            const dateStr = date.toLocaleDateString('id-ID', {
                                day: '2-digit',
                                month: 'short',
                                year: 'numeric'
                            });
                            
                            return `
                                <tr>
                                    <td>${dateStr}</td>
                                    <td>${h.arisanName}</td>
                                    <td>Putaran ${h.round}</td>
                                    <td>Rp ${h.nominal.toLocaleString('id-ID')}</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
        }
        
        // =====================================================
        // FORMAT RUPIAH (UTILITY)
        // =====================================================
        function formatRupiah(angka) {
            return 'Rp ' + parseInt(angka).toLocaleString('id-ID');
        }
        
        // =====================================================
        // GENERATE ID (UTILITY)
        // =====================================================
        function generateId(prefix) {
            return prefix + '_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
    </script>

</body>
</html>
